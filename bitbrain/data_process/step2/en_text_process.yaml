# global parameters
#! 参考自Data-juicer官方的C4数据集清洗脚本
#! 具体代码：https://github.com/modelscope/data-juicer/blob/main/configs/data_juicer_recipes/redpajama-c4-refine.yaml
project_name: 'Data-Juicer-recipes-c4-changed'
dataset_path: '/DATA/disk2/yuhang/.cache/bit_brain_data/step1_unified_format/processed_dolma_en.jsonl'  # path to your dataset directory or file
export_path: '/DATA/disk2/yuhang/.cache/bit_brain_data/data_juicer_clean_code_data/en_datas/dataset_text_en.jsonl' # path to your dataset result file

np: 20  # number of subprocess to process your dataset
open_tracer: True

# process schedule
# a list of several process operators with their arguments
export_shard_size: 0  
export_in_parallel: false   
text_keys: 'text' 
#keep_original_sample: false          #* 不保留原始样本的所有字段
export_original_dataset: false      #* 不导出原始数据集的所有字段

suffixes: []                                                # the suffix of files that will be read. For example: '.txt', 'txt' or ['txt', '.pdf', 'docx']
use_cache: false                                             # whether to use the cache management of Hugging Face datasets. It might take up lots of disk space when using cache
ds_cache_dir: /DATA/disk2/yuhang/.cache/dj_cache                                          # cache dir for Hugging Face datasets. In default, it\'s the same as the environment variable `HF_DATASETS_CACHE`, whose default value is usually "~/.cache/huggingface/datasets". If this argument is set to a valid path by users, it will override the default cache dir
use_checkpoint: False                                       # whether to use the checkpoint management to save the latest version of dataset to work dir when processing. Rerun the same config will reload the checkpoint and skip ops before it. Cache will be disabled when using checkpoint. If args of ops before the checkpoint are changed, all ops will be rerun from the beginning.
temp_dir: /DATA/disk2/yuhang/.cache/dj_cache                                              # the path to the temp directory to store intermediate caches when cache is disabled, these cache files will be removed on-the-fly. In default, it's None, so the temp dir will be specified by system. NOTICE: you should be caution when setting this argument because it might cause unexpected program behaviors when this path is set to an unsafe directory.
open_tracer: true                                          # whether to open the tracer to trace the changes during process. It might take more time when opening tracer
op_list_to_trace: []                                        # only ops in this list will be traced by tracer. If it's empty, all ops will be traced. Only available when tracer is opened.
trace_num: 10                                               # number of samples to show the differences between datasets before and after each op. Only available when tracer is opened.
op_fusion: true                                            # whether to fuse operators that share the same intermediate variables automatically. Op fusion might reduce the memory requirements slightly but speed up the whole process.
#cache_compress: zstd                                        # the compression method of the cache file, which can be specified in ['gzip', 'zstd', 'lz4']. If this parameter is None, the cache file will not be compressed. We recommend you turn on this argument when your input dataset is larger than tens of GB and your disk space is not enough.



process:
  - clean_email_mapper:                                     # remove emails from text.
  - clean_html_mapper:                                      # remove html formats form text.
  - clean_ip_mapper:                                        # remove ip addresses from text.
  - clean_links_mapper:                                     # remove web links from text.
  - clean_copyright_mapper:                                 # remove copyright comments.
  - expand_macro_mapper:                                    # expand macro definitions in Latex text.
  - fix_unicode_mapper:
  - punctuation_normalization_mapper:
  - whitespace_normalization_mapper:

  - alphanumeric_filter:
      tokenization: false
      min_ratio: 0.65  # <3sigma (0.740)
      max_ratio: 0.9   # >3sigma (0.867)
  - average_line_length_filter:  # for code
      max_len: 3000  # >3sigma (1277)
  - character_repetition_filter:
      rep_len: 10
      max_ratio: 0.3  # >3sigma (0.168)
  - language_id_score_filter:
      min_score: 0.6
  - maximum_line_length_filter:  # for code
      max_len: 4000  # >3sigma (2017)
  - perplexity_filter:
      lang: en
      max_ppl: 5000 #(>3sigma 4543)
  - special_characters_filter:
      max_ratio: 0.4  # > 3sigma (0.303)
  - words_num_filter:
      tokenization: true
      min_num: 20
      max_num: 10000
  - word_repetition_filter:
      lang: en
      tokenization: true
      rep_len: 10
      max_ratio: 0.231  # 3sigma

  - document_simhash_deduplicator:
      tokenization: space
      window_size: 6
      lowercase: true
      ignore_pattern: '\p{P}'
      num_blocks: 6
      hamming_distance: 4